<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <title>Sistema de Redações</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; }
    h1 { text-align: center; }
    #timer { font-size: 48px; text-align: center; margin: 20px; color: green; }
    .controls, .settings, .stats { margin: 20px auto; max-width: 600px; background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .controls button { padding: 10px 20px; margin: 5px; font-size: 16px; }
    .settings label, .stats div { display: block; margin: 10px 0; }
    .settings input[type=number], .settings select { width: 100%; padding: 8px; font-size: 14px; margin-top: 5px; }
    .mute { font-size: 14px; max-width: 600px; margin: 0 auto; }
  </style>
</head>
<body>
  <h1>Sistema de Redações</h1>
  <div id="timer">15:00</div>

  <div class="controls">
    <button id="start">Iniciar Ciclo</button>
    <button id="pause">Pausar</button>
    <button id="mark">Redação Concluída</button>
  </div>

  <div class="settings">
    <label>Turma:
      <select id="turmaSelect">
        <option disabled selected>Selecione...</option>
      </select>
    </label>
    <label>Meta da turma:
      <input type="number" id="metaInput" value="0" min="0"/>
    </label>
    <label>Redações feitas:
      <input type="number" id="feitasInput" value="0" min="0"/>
    </label>
    <label>Dias para cumprir tema:
      <input type="number" id="diasInput" value="7" min="1"/>
    </label>
  </div>

  <div class="stats" id="stats"></div>

  <div class="mute">
    <label><input type="checkbox" id="muteRolha" checked/> Som Rolha</label>
    <label><input type="checkbox" id="muteCaixa" checked/> Som Caixa</label>
    <label><input type="checkbox" id="muteToim" checked/> Som Toim</label>
    <label><input type="checkbox" id="muteAlarme" checked/> Som Alarme</label>
  </div>

  <audio id="audioRolha" src="https://assets.mixkit.co/active_storage/sfx/3229/3229-preview.mp3"></audio>
  <audio id="audioCaixa" src="https://assets.mixkit.co/active_storage/sfx/3510/3510-preview.mp3"></audio>
  <audio id="audioToim" src="https://assets.mixkit.co/active_storage/sfx/quiet-bell-chime-605-preview.mp3"></audio>
  <audio id="audioAlarme" src="https://assets.mixkit.co/active_storage/sfx/alert-fast-605-preview.mp3"></audio>

  <script>
    const turmas = ["1ºSA A","1ºSA B","1ºSA C","1ºSA D",
                    "2ºSA A","2ºSA B","2ºSA C",
                    "3ºSA A","3ºSA B",
                    "1ºSBC A","1ºSBC B",
                    "2ºSBC A","2ºSBC B","3ºSBC",
                    "1ºSCS A","1ºSCS B","2ºSCS A","2ºSCS B","3ºSCS"];
    let metas = {}, feitasTurma = {};
    turmas.forEach(t => { metas[t]=0; feitasTurma[t]=0; });

    const timerEl = document.getElementById('timer'),
          startBtn = document.getElementById('start'),
          pauseBtn = document.getElementById('pause'),
          markBtn = document.getElementById('mark'),
          turmaSelect = document.getElementById('turmaSelect'),
          metaInput = document.getElementById('metaInput'),
          feitasInput = document.getElementById('feitasInput'),
          diasInput = document.getElementById('diasInput'),
          statsEl = document.getElementById('stats');

    const audio = {
      rolha: document.getElementById('audioRolha'),
      caixa: document.getElementById('audioCaixa'),
      toim: document.getElementById('audioToim'),
      alarme: document.getElementById('audioAlarme')
    };

    function play(id, muteId, vol=1){
      if(!document.getElementById(muteId).checked) return;
      const a = audio[id];
      a.volume = vol; a.currentTime = 0; a.play().catch(()=>{});
    }

    turmas.forEach(t => {
      const opt = document.createElement('option');
      opt.value = t; opt.textContent = t;
      turmaSelect.appendChild(opt);
    });

    function updateStats(){
      let totalMeta=0, totalFeitas=0;
      turmas.forEach(t => {
        totalMeta += metas[t];
        totalFeitas += feitasTurma[t];
      });
      const faltam = Math.max(0, totalMeta - totalFeitas),
            diaria = (faltam/(parseInt(diasInput.value)||1)).toFixed(1),
            bruto = (totalFeitas*3.54).toFixed(3),
            liquido = (totalFeitas*3.009).toFixed(3),
            imposto = (totalFeitas*0.531).toFixed(3);

      statsEl.innerHTML = `
        <div>Feitas (total): ${totalFeitas} / ${totalMeta}</div>
        <div>Faltam: ${faltam}</div>
        <div>Meta diária: ${diaria}</div>
        <div>Bruto: R$ ${bruto}</div>
        <div>Líquido: R$ ${liquido}</div>
        <div>Imposto: R$ ${imposto}</div>`;
    }

    turmaSelect.onchange = () => {
      const t = turmaSelect.value;
      metaInput.value = metas[t];
      feitasInput.value = feitasTurma[t];
    };

    metaInput.oninput = () => {
      const t = turmaSelect.value;
      metas[t] = parseInt(metaInput.value)||0;
      updateStats();
      play('rolha','muteRolha');
    };

    feitasInput.oninput = () => {
      const t = turmaSelect.value;
      feitasTurma[t] = parseInt(feitasInput.value)||0;
      updateStats();
      play('rolha','muteRolha');
    };

    diasInput.oninput = updateStats;

    let tempo=900, timerId, remindId, pausado=false;
    function tick(){
      if(!pausado){
        const m=String(Math.floor(tempo/60)).padStart(2,'0'),
              s=String(tempo%60).padStart(2,'0');
        timerEl.textContent = `${m}:${s}`;
        if(tempo <= 150) timerEl.style.color = (tempo % 2 === 0) ? 'red' : '#800';
        if(tempo <= 0){
          clearInterval(timerId); clearInterval(remindId);
          play('alarme','muteAlarme');
        }
        tempo--;
      }
    }

    startBtn.onclick = () => {
      pausado = false;
      clearInterval(timerId); clearInterval(remindId);
      tempo = 900;
      timerEl.style.color = 'green';
      timerId = setInterval(tick, 1000);
      remindId = setInterval(()=>play('toim','muteToim',0.5), 120000);
    };

    pauseBtn.onclick = () => { pausado = !pausado; };

    markBtn.onclick = () => {
      const t = turmaSelect.value;
      if(!t) return alert('Selecione uma turma!');
      feitasTurma[t]++;
      feitasInput.value = feitasTurma[t];
      updateStats();
      play('caixa','muteCaixa');
    };

    window.onload = () => {
      updateStats();

      // Desbloqueia os sons com o primeiro clique
      document.body.addEventListener("click", () => {
        Object.values(audio).forEach(a => {
          a.volume = 0;
          a.play().catch(()=>{});
          a.pause();
          a.currentTime = 0;
          a.volume = 1;
        });
      }, { once: true });
    };
  </script>
</body>
</html>
